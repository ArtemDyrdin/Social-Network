{% extends 'network/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block body%}

{% load tz %}
{% load dialogs_tag %}
{% if chats.count == 0 %}
    <div class="">
        <p>Нет ни одного начатого диалога</p>
    </div>
{% endif %}

<h2>Chats</h2>

<div class="container d-flex justify-content-center">
    <ul class="list-group col-5">
        {% for chat in chats %}
            {% if chat.message_set.count != 0 %}
                {% with last_message=chat.message_set.last %}
                    {% get_companion user chat as companion %}
                    <li class="list-group-item mb-1">
                        <a class="list-group-item {% if companion == last_message.author and not last_message.is_readed %}unreaded{% endif %} card-link friend" href="/dialogs/{{ chat.id }}">
                            <div class="reply-body">
                                <ul class="list-inline">
                                    <li class="drop-left-padding">
                                        <strong class="list-group-item-heading">{{ companion.first_name }} {{ companion.last_name }}</strong>
                                    </li>
                                    <li class="pull-right text-muted"><small>{{ last_message.pub_date|utc }}</small></li>
                                </ul>
                                {% if companion != last_message.author %}
                                    <div>
                                        <div class="attached-reply-body {% if not last_message.is_readed %}unreaded{% endif %}">{{ last_message.message|truncatechars_html:"200"|safe|striptags }}</div>
                                    </div>
                                {% else %}
                                    <div>{{ last_message.message|truncatechars_html:"200"|safe|striptags }}</div>
                                {% endif %}
                            </div>
                        </a>
                    </li>
                {% endwith %}
            {% endif %}
        {% endfor %}
    </ul>
</div>

{% endblock %}